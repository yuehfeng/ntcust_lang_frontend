{"remainingRequest":"C:\\www-server\\ntcust_lang_frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\www-server\\ntcust_lang_frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\www-server\\ntcust_lang_frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\www-server\\ntcust_lang_frontend\\src\\views\\components\\Manage-Album-Create.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\www-server\\ntcust_lang_frontend\\src\\views\\components\\Manage-Album-Create.vue","mtime":1647371298555},{"path":"C:\\www-server\\ntcust_lang_frontend\\babel.config.js","mtime":1647072923606},{"path":"C:\\www-server\\ntcust_lang_frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1645007183919},{"path":"C:\\www-server\\ntcust_lang_frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1645007186797},{"path":"C:\\www-server\\ntcust_lang_frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1645007183919},{"path":"C:\\www-server\\ntcust_lang_frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1645007187285}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKLy8gaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgdXNlSW1hZ2VVcGxvYWQgfSBmcm9tICcuL3VzZUltYWdlVXBsb2FkJzsKaW1wb3J0IHsgQWxidW1TZXJ2ZXIsIEZpbGVMaW5rU2VydmVyIH0gZnJvbSAnLi4vLi4vcHJvdmlkZXJzL2h0dHAtc2VydmVyJzsKaW1wb3J0IHsgcmVmIH0gZnJvbSAidnVlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJIb21lIiwKICBzZXR1cDogZnVuY3Rpb24gc2V0dXAoKSB7CiAgICB2YXIgbWVzc2FnZSA9IHJlZigiIik7CiAgICB2YXIgaW1hZ2VzID0gcmVmKFtdKTsKICAgIHZhciBhbGJ1bU5hbWUgPSByZWYoIiIpOwogICAgdmFyIGFsYnVtRGVzY3JpcHRpb24gPSByZWYoIiIpOwogICAgdmFyIGFsYnVtQ29udGV4dCA9IHJlZigiIik7CiAgICB2YXIgc3VjY2Vzc0lEID0gMDsKICAgIHZhciBudW1QaG90byA9IDA7CgogICAgdmFyIF91c2VJbWFnZVVwbG9hZCA9IHVzZUltYWdlVXBsb2FkKCksCiAgICAgICAgaW1hZ2VGaWxlID0gX3VzZUltYWdlVXBsb2FkLmltYWdlRmlsZSwKICAgICAgICBpbWFnZVVybCA9IF91c2VJbWFnZVVwbG9hZC5pbWFnZVVybCwKICAgICAgICBoYW5kbGVJbWFnZVNlbGVjdGVkID0gX3VzZUltYWdlVXBsb2FkLmhhbmRsZUltYWdlU2VsZWN0ZWQ7CgogICAgZnVuY3Rpb24gaGFuZGxlU3VibWl0KCkgewogICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgZm9ybURhdGEuYXBwZW5kKCJmaWxlIiwgaW1hZ2VGaWxlLnZhbHVlKTsKICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgcmVxdWVzdC5vcGVuKCJQT1NUIiwgImh0dHA6Ly9sb2NhbGhvc3QvbnRjdXN0X2xhbmdfYmFja2VuZC9wdWJsaWMvYXBpL2ZpbGUvY3JlYXRlIik7CiAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdBUElfVE9LRU4nKSk7CiAgICAgIHJlcXVlc3Quc2VuZChmb3JtRGF0YSk7CgogICAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT09IDIwMCAmJiByZXF1ZXN0LnN0YXR1c1RleHQgPT09ICdPSycpIHsKICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdudW1QaG90bycpID09IDApIEFsYnVtU2VydmVyLnVwZGF0ZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnQUxCVU1fSUQnKSwgewogICAgICAgICAgICAgIGNvdmVyX2ZpbGU6IEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZSkuZGF0YS5pZAogICAgICAgICAgICB9KS50aGVuKCk7CiAgICAgICAgICAgIEZpbGVMaW5rU2VydmVyLmNyZWF0ZSh7CiAgICAgICAgICAgICAgZmlsZV9pZDogSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlKS5kYXRhLmlkLAogICAgICAgICAgICAgIHR5cGVfaWQ6IDUsCiAgICAgICAgICAgICAgc2hlZXRfaWQ6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdBTEJVTV9JRCcpCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgey8vIGNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdudW1QaG90bycsIE51bWJlcihsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbnVtUGhvdG8nKSkgKyAxKTsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gIuebruWJjee4veWFseaIkOWKn+S4iuWCsyIgKyBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbnVtUGhvdG8nKSArICLlvLXlnJbniYciOwogICAgICAgICAgICBpbWFnZVVybC52YWx1ZSA9ICIiOwogICAgICAgICAgICBpbWFnZUZpbGUudmFsdWUgPSAiIjsKICAgICAgICAgIH0gZWxzZSB7Ly8gY29uc29sZS5sb2coJ2ZhaWxlZCcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBoYW5kbGVJbWFnZVNlbGVjdGVkOiBoYW5kbGVJbWFnZVNlbGVjdGVkLAogICAgICBpbWFnZVVybDogaW1hZ2VVcmwsCiAgICAgIGhhbmRsZVN1Ym1pdDogaGFuZGxlU3VibWl0LAogICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICBpbWFnZXM6IGltYWdlcywKICAgICAgYWxidW1OYW1lOiBhbGJ1bU5hbWUsCiAgICAgIGFsYnVtRGVzY3JpcHRpb246IGFsYnVtRGVzY3JpcHRpb24sCiAgICAgIGFsYnVtQ29udGV4dDogYWxidW1Db250ZXh0LAogICAgICBzdWNjZXNzSUQ6IHN1Y2Nlc3NJRCwKICAgICAgbnVtUGhvdG86IG51bVBob3RvCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgY3JlYXRlRGF0YTogZnVuY3Rpb24gY3JlYXRlRGF0YSgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gewogICAgICAgIG5hbWU6IHRoaXMuYWxidW1OYW1lLAogICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmFsYnVtRGVzY3JpcHRpb24sCiAgICAgICAgY29udGV4dDogdGhpcy5hbGJ1bUNvbnRleHQKICAgICAgfTsKICAgICAgQWxidW1TZXJ2ZXIuY3JlYXRlKGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMubWVzc2FnZSA9ICLnm7jnsL/mlrDlop7miJDlip/vvIzoq4vkuIrlgrPnm7jniYfjgIIiOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdBTEJVTV9JRCcsIHJlc3BvbnNlLmRhdGEuaWQpOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdudW1QaG90bycsIDApOwogICAgICB9KTsKICAgIH0sCiAgICBjb21wbGV0ZUFsYnVtOiBmdW5jdGlvbiBjb21wbGV0ZUFsYnVtKCkgewogICAgICB0aGlzLm1lc3NhZ2UgPSAi55u457C/5bu656uL5a6M5oiQ77yM6KuL6YeN5paw5pu05paw57ay6aCB5YmN5b6A6aCQ6Ka944CCIjsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oIm51bVBob3RvIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJBTEJVTV9JRCIpOwogICAgICB0aGlzLiRyb3V0ZXIuZ28oMCk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["C:\\www-server\\ntcust_lang_frontend\\src\\views\\components\\Manage-Album-Create.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <b-button v-b-toggle.collapse-2 variant=\"success m-2\">建立相簿</b-button>\r\n    <b-collapse id=\"collapse-2\" class=\"m-2\">\r\n        <b-card v-if=\"!message\">\r\n            <b-row class=\"my-2\">\r\n                <b-col md=\"2\">\r\n                    <label for=\"\">相簿名稱</label>\r\n                </b-col>\r\n                <b-col md=\"10\">\r\n                    <b-form-input v-model=\"albumName\" placeholder=\"請填入相簿名稱\"></b-form-input>\r\n                </b-col>\r\n            </b-row>\r\n            <b-row class=\"my-2\">\r\n                <b-col md=\"2\">\r\n                    <label for=\"\">相簿說明</label>\r\n                </b-col>\r\n                <b-col md=\"10\">\r\n                    <b-form-textarea\r\n                        id=\"textarea\"\r\n                        v-model=\"albumDescription\"\r\n                        placeholder=\"請填入相簿說明\"\r\n                        rows=\"5\"\r\n                        max-rows=\"5\"\r\n                        >\r\n                    </b-form-textarea>\r\n                </b-col>\r\n            </b-row>\r\n            <b-row class=\"my-2\">\r\n                <b-col md=\"2\">\r\n                    <label for=\"\">相簿內文</label>\r\n                </b-col>\r\n                <b-col md=\"10\">\r\n                    <b-form-textarea\r\n                        id=\"textarea\"\r\n                        v-model=\"albumContext\"\r\n                        placeholder=\"請填入相簿內文\"\r\n                        rows=\"5\"\r\n                        max-rows=\"5\"\r\n                        >\r\n                    </b-form-textarea>\r\n                </b-col>\r\n            </b-row>\r\n            <b-row class=\"my-2 text-center\">\r\n                <b-col md=\"12\">\r\n                    <b-button variant=\"success m-2\" \r\n                        @click=\"createData\" \r\n                        v-b-popover.hover.bottom=\"'下一步再上傳圖片'\" \r\n                        title=\"創建相簿\">\r\n                        下一步\r\n                    </b-button>\r\n                </b-col>\r\n            </b-row>\r\n        </b-card>\r\n        <!--  -->\r\n        <form id=\"form\" ref=\"form\" class=\"\" @submit.prevent=\"handleSubmit\">\r\n        <b-card v-if=\"message\">\r\n            <b-alert show variant=\"success\">{{ message }}</b-alert>\r\n            <b-row class=\"my-2\">\r\n                <b-col md=\"2\">\r\n                    <label for=\"\">新增圖片</label>\r\n                </b-col>\r\n                <b-col md=\"10\">\r\n                    <div class=\"min-h-screen flex items-center justify-center\">\r\n                        <img v-show=\"imageUrl\"\r\n                            :src=\"imageUrl\"\r\n                            class=\"w-48 h-48 object-cover\"\r\n                            width=\"200\">\r\n                        <div>\r\n                            <input type=\"file\"\r\n                                accept=\"image/*\"\r\n                                @change=\"handleImageSelected\">\r\n                        </div>\r\n                        <div class=\"flex flex-wrap mt-8\">\r\n                            <img v-for=\"(image, key) in images\"\r\n                                :key=\"key\"\r\n                                :src=\"image.image\"\r\n                                class=\"w-48 h-46 object-cover mr-4 mb-4 shadow rounded\">\r\n                        </div>\r\n                    </div>\r\n                </b-col>\r\n            </b-row>\r\n            <b-row class=\"my-2 text-center\">\r\n                <b-col md=\"12\">\r\n                    <b-button variant=\"success m-2\" \r\n                        type=\"submit\"\r\n                        v-b-popover.hover.bottom=\"'如果還需要上傳圖片，請先按此按鈕。'\" \r\n                        title=\"上傳圖片\">\r\n                        確認圖片\r\n                    </b-button>\r\n                    <b-button variant=\"primary m-2\" \r\n                        v-b-popover.hover.bottom=\"'如果無需要再上傳圖片，請按此按鈕。'\"\r\n                        @click=\"completeAlbum\" \r\n                        title=\"完成編輯\">\r\n                        建立完成\r\n                    </b-button>\r\n                </b-col>\r\n            </b-row>\r\n        </b-card>\r\n        </form>\r\n        <!--  -->\r\n    </b-collapse>\r\n</template>\r\n\r\n<script>\r\n// import axios from 'axios';\r\nimport { useImageUpload } from './useImageUpload';\r\nimport { AlbumServer, FileLinkServer } from '../../providers/http-server';\r\nimport { ref } from \"vue\";\r\nexport default {\r\n    name: \"Home\",\r\n    setup() {\r\n        var message = ref(\"\");\r\n        var images = ref([]);\r\n        var albumName = ref(\"\");\r\n        var albumDescription = ref(\"\");\r\n        var albumContext = ref(\"\");\r\n        var successID = 0;\r\n        var numPhoto = 0;\r\n            \r\n        var { imageFile, imageUrl, handleImageSelected } = useImageUpload();\r\n\r\n        function handleSubmit() {\r\n            var formData = new FormData();\r\n            formData.append(\"file\", imageFile.value);\r\n            var request = new XMLHttpRequest();\r\n            request.open(\"POST\", \"http://localhost/ntcust_lang_backend/public/api/file/create\");\r\n            request.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('API_TOKEN'));\r\n            request.send(formData);\r\n            request.onreadystatechange = function () {\r\n                if (request.readyState === 4) {\r\n                    if (request.status === 200 && request.statusText === 'OK') {\r\n                        if(localStorage.getItem('numPhoto') == 0)\r\n                            AlbumServer.update(localStorage.getItem('ALBUM_ID'), {\r\n                                cover_file: JSON.parse(request.response).data.id\r\n                            }).then(\r\n                                // () => //console.log(res)\r\n                            );\r\n                            FileLinkServer.create({\r\n                                file_id: JSON.parse(request.response).data.id,\r\n                                type_id: 5,\r\n                                sheet_id: localStorage.getItem('ALBUM_ID')\r\n                            }).then(() => {\r\n                                // console.log(res)\r\n                            });\r\n                            localStorage.setItem('numPhoto', Number(localStorage.getItem('numPhoto'))+1);\r\n                            this.message = \"目前總共成功上傳\" + localStorage.getItem('numPhoto') + \"張圖片\";\r\n                            imageUrl.value = \"\";\r\n                            imageFile.value = \"\";\r\n                        } else {\r\n                            // console.log('failed');\r\n                        }\r\n                }\r\n            }\r\n            \r\n        }\r\n        return {\r\n            handleImageSelected,\r\n            imageUrl,\r\n            handleSubmit,\r\n            message,\r\n            images,\r\n            albumName,\r\n            albumDescription,\r\n            albumContext,\r\n            successID,\r\n            numPhoto,\r\n        };\r\n    },\r\n    methods: {\r\n        createData() {\r\n            let data = {\r\n                name: this.albumName,\r\n                description: this.albumDescription,\r\n                context: this.albumContext\r\n            };\r\n            AlbumServer.create(data).then((response) => {\r\n                this.message = \"相簿新增成功，請上傳相片。\";\r\n                localStorage.setItem('ALBUM_ID', response.data.id);\r\n                localStorage.setItem('numPhoto', 0);\r\n            });\r\n        },\r\n        completeAlbum() {\r\n            this.message = \"相簿建立完成，請重新更新網頁前往預覽。\";\r\n            localStorage.removeItem(\"numPhoto\");\r\n            localStorage.removeItem(\"ALBUM_ID\");\r\n            this.$router.go(0);\r\n        }\r\n    }\r\n};\r\n</script>\r\n"],"sourceRoot":""}]}